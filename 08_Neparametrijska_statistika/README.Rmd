---
title: "Neparametrijska statistika i statistika kategoričkih podataka"
author: "Lucija Kanjer, lucija.kanjer@biol.pmf.hr"
date: "`2025/26"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Sadržaj ove vježbe

Neparametrijska statistika

 - Wilcoxon-Mann-Whitney test
 - Wilcoxon test za uparene uzorke
 
Statistika kategoričkih podataka

- Chi-kvadrat test
- Binomialni test

## Tema: pokusi s klijancima biljaka

- __Pokus 1__: Je li broj klijanaca značajno drugačiji bez i s dodatkom gnojiva?
- __Pokus 2__: Je li broj plodova na biljkama značajno drugačiji prije i poslije dodatka gnojiva?
- __Pokus 3__: Je li broj klijanaca iz 3 različita gnojiva značajno drugačiji od očekivanog?
- __Pokus 4__: Je li broj uspješno proklijanih sjemenki 60%? 


```{r paketi}
# Priprema
library(tidyr)
library(ggplot2)
set_theme(theme_minimal())
```

# 1. Neparametrijska statistika - neovisni uzorci

__Pokus 1__: Broj uspjeha klijanja sjemenki bez gnojiva (kontrola) i s gnojivom

Je li broj klijanaca značajno drugačiji bez i sa dodatkom gnojiva?

```{r pokus1}
# Učitavanje dataseta
biljke_pokus1 <- read.csv("biljke_pokus1.csv")

# Uvid u podatke 
head(biljke_pokus1)
```

## Vizualizacija razlika između grupa

#### Kreiranje tablice u dugačkom (long) formatu

```{r long}
# Kreiranje tablice u dugačkom (long) formatu - za crtanje plotova

biljke_pokus1$id_retka <- c(1:15) # dodavanje stupca za identifikaciju redaka

biljke_pokus1_long <- pivot_longer(biljke_pokus1, cols = c(kontrola, gnojivo), names_to = "tretman", values_to = "proklijalo")

head(biljke_pokus1_long)
```


### Boxplot

```{r boxplot_pokus1}
# Vizualizacija podataka iz pokusa 1
ggplot(biljke_pokus1_long, aes(x = tretman, y = proklijalo, fill = tretman)) +
  geom_boxplot()
```

### Histogram - Vizualizacija distribucije podataka

```{r hist_pokus1}
# Histogrami
ggplot(biljke_pokus1_long, aes(x = proklijalo, fill = tretman)) +
  geom_histogram(binwidth = 3, color = "black") + facet_wrap (~ tretman, nrow = 2)
```

## Ima li statistički značajne razlike između grupa kontrola i gnojivo?

- Podaci __nisu normalno distribuirani__, stoga ne možemo koristiti t-test!
- Moramo koristiti test koji __ne pretpostavlja__ normalnu distribuciju podataka.
- Koristimo __neparamatrijsku statistiku__

__Wilcoxon-Mann-Whitney rank-sum test (Mann-Whitney U)__

- neparametrijska verzija t-testa
- Prednosti: nema pretpostavke o distribuciji podataka, pogodan za mali broj opažanja
- Mane: manja statistička snaga testa

## Wilcoxon-Mann-Whitney test za neovisne uzorke

#### <code> wilcox.test(grupa1, grupa2) </code>

#### Vraćanje tablice u široki (wide) format - za testiranje

```{r wide}
# Kreiranje tablice u širokom (wide) formatu - za testiranje
biljke_pokus1_wide <- pivot_wider(biljke_pokus1_long, names_from = tretman, values_from = proklijalo)

head(biljke_pokus1_wide)
```



```{r wilcox}
# Wilcoxon-Mann-Whitney test za neovisne uzorke
wilcox.test(biljke_pokus1_wide$kontrola, biljke_pokus1$gnojivo)

```

## Rezultati Wilcoxon-Mann-Whitney testa

__Nulta hipoteza__: Ne postoji značajna razlika između broja klijanaca u konrolnoj grupi i u grupi koja je tretirana gnojivom.

- __W = 9__ - Ovo je statistika testa, koja predstavlja rang-sum razliku između skupina. Sama po sebi nema biološki značaj, ali se koristi za izračunavanje p-vrijednosti.

- __p-value = 1.251e-06__ - Ovo je jako mala p-vrijednost, znatno manja od uobičajene razine značajnosti (npr., 0.05).

- Značajna p-vrijednost ukazuje na __odbacivanje nul-hipoteze__ (da ne postoji razlika između distribucija dvije skupine).

- Implikacije: Tretman gnojivom vjerojatno ima učinak na uspjeh biljaka (npr., povećava ili smanjuje uspjeh u odnosu na kontrolu)

# 2. Neparametrijska statistika - upareni uzorci

__Pokus 2__: broj plodova prije i poslije dodatka gnojiva

Je li broj plodova na biljkama značajno drugačiji prije i poslije dodatka gnojiva?

```{r pokus2}
# Učitajte dataset!
biljke_pokus2 <- read.csv("biljke_pokus2.csv")

head(biljke_pokus2)
```

## Vizualizacija pomoću boxplota

```{r boxplot_pokus2}
# Vizualizacija podataka iz pokusa 2
# Kreiranje tablice u dugačkom (long) formatu - za crtanje plotova
biljke_pokus2$id_biljke <- c(1:19)

biljke_pokus2_long <- pivot_longer(biljke_pokus2, 
                                   cols = c(prije_gnojiva, poslije_gnojiva), 
                                   names_to = "tretman", 
                                   values_to = "proklijalo")

# Vizualizacija podataka iz pokusa 1
ggplot(biljke_pokus2_long, aes(x = tretman, y = proklijalo, fill = tretman)) +
  geom_boxplot() + geom_point() + geom_line(aes(group = id_biljke), alpha = 0.5)
```

## Vizualizacija distribucije podataka

```{r hist_pokus2}
# Histogrami
ggplot(biljke_pokus2_long, aes(x = proklijalo, fill = tretman)) +
  geom_histogram(binwidth = 3, color = "black") + facet_wrap (~ tretman, nrow = 2)
```

## Ima li statistički značajne razlike između broja plodova na biljci prije i nakon dodatka gnojiva?

- koristimo neparametrijski test za uparene uzorke

__Wilcoxon signed rank test__

- neparametrijska verzija t-testa za uparene (ovisne) uzorke

## Wilcoxonov test za uparene uzorke

<code>wilcox.test(prije, poslije, __paired = TRUE__)</code>

```{r wilcoxpaired}
# Wilcoxonov test za uparene uzorke
wilcox.test(biljke_pokus2$prije_gnojiva, biljke_pokus2$poslije_gnojiva, 
            paired = TRUE)

```


## Rezultati Wilcoxonovog testa za uparene uzorke

- V = 20 - Ovo je statistika testa, koja predstavlja sumu rangova apsolutnih razlika između uparenih mjerenja. Sama po sebi nije intuitivna, ali se koristi za izračun p-vrijednosti.
- __p-value = 0.0007076__ - Ovo je jako mala p-vrijednost, što ukazuje na značajnu razliku između uparenih skupina.

## Statistika kategoričkih podataka

__Pokus 3__: Postotak uspješno proklijalih sjemenki gnojiva A, gnojiva B i kontrolne skupine

Je li broj klijanaca iz 3 različita gnojiva značajno drugačiji od očekivanog (svi podjednaki uspjeh)?

```{r pokus 3}
# Učitajte dataset!
biljke_pokus3 <- read.csv("biljke_pokus3.csv")

print(biljke_pokus3)
```

## {.smaller}

```{r ggplot}
# Vizualizacija podataka
ggplot(biljke_pokus3, aes(x = gnojiva, y = proklijano)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_hline(aes(yintercept = ocekivano), color = "red", linetype = "dashed")
```

# 3. Hi-hvadrat test

Kada koristiti? 

Tip podataka: Test se koristi za __kategoričke podatke__, gdje analiziramo brojeve u različitim kategorijama .

Očekivane frekvencije: Test procjenjuje __odstupanja između promatranih frekvencija i očekivanih frekvencija__, koje su definirane na temelju očekivane raspodjele (npr. jednake raspodjele za svaku kategoriju).

## Hi-hvadrat test

<code>chisq.test(promatrano, p = ocekivano / sum(ocekivano))</code>

```{r hi kvadrat}
# Hi-kvadrat test
chisq.test(biljke_pokus3$proklijano, p = biljke_pokus3$ocekivano / sum(biljke_pokus3$ocekivano))

```

## Rezultati hi-kvadrat testa

- Chi-kvadrat statistika: __*X*-squared__ = 4: Ovo je testna statistika koja mjeri koliko promatrane vrijednosti odstupaju od očekivanih vrijednosti. Veće vrijednosti ukazuju na veća odstupanja između promatranih i očekivanih frekvencija.

- Stupnjevi slobode (df): __df = 2__: Broj stupnjeva slobode u ovom testu je broj kategorija minus 1 (3 kategorije - 1 = 2).

- p-vrijednost: __p-value = 0.1353__: Ova p-vrijednost je veća od uobičajene razine značajnosti (npr., 0.05). stoga ne možemo odbaciti nul hipotezu. Nema značajnih razlika između promatranih frekvencija proklijalih sjemenki i očekivanih vrijednosti. Razlike u broju proklijalih sjemenki između kategorija (Gnojivo A, Gnojivo B i Kontrola) mogle su se dogoditi slučajno.


# 4. Statistika binomnih podataka

__Pokus 4__: Razvijamo novo gnojivo te želimo testirati je li bolje od starog gnojiva. Znamo da staro gnojivo ima stopu klijanja 60%. Od 25 sjemenki, 18 je uspješno proklijalo.

Je li broj uspješno proklijanih sjemenki statistički značajno drugačiji od  60%? 

```{r pokus4}
# Učitavanje dataseta
biljke_pokus4 <- read.csv("biljke_pokus4.csv")

print(biljke_pokus4)
```

## Koristimo __binomialni test__

Kada koristiti binomialni test?

- Kada analiziramo __binarne podatke__ (uspjeh/neuspjeh).
- Kada želite testirati vjerojatnost uspjeha u odnosu na __poznatu ili pretpostavljenu__ vrijednost.
- Kada je __uzorak malen__, pa aproksimativne metode nisu dovoljno precizne.

## Binomialni test u R-u

<code>binom.test(uspjesi, pokušaji, p = vjerojatnost)</code>

```{r binom}
# Binomialni test
binom.test(biljke_pokus4$klijanci, biljke_pokus4$broj_sjemenki, p = biljke_pokus4$vjerojatnost)
```

## Rezultati binomialnog testa

- __p = 0.3073__ - P-vrijednost je veća od uobičajene razine značajnosti (npr., 0.05). Ovo sugerira da ne možemo odbaciti nul-hipotezu. Drugim riječima, nema dovoljno dokaza da je stvarna vjerojatnost uspjeha različita od 0.6.

- Interval pouzdanosti (95%): __(0.5061,0.8793)__: Stvarna vjerojatnost uspjeha (temeljena na uzorku) s 95% pouzdanosti leži unutar ovog raspona. Interval uključuje očekivanu vjerojatnost (0.6), što dodatno podržava zaključak da nema značajne razlike.

- Procjena stvarne vjerojatnosti uspjeha: Procijenjena vjerojatnost uspjeha temeljem podataka je __0.72__ (tj. 18/25), ali ta vrijednost nije značajno različita od 0.6 prema ovom testu.

##  Samostalni zadaci:

### __Tema: Utjecaj različitih prehrana na težinu miševa__

#### Zadatak 1
- Učitajte tablicu "misevi_zadatak1.csv"
- Napravite boxplot podataka
- Napravite histograme za varijable.
- Jesu li težine miševa pod prehranom A i prehranom B značajno različite?

#### Zadatak 2
- Učitajte tablicu "misevi_zadatak2.csv"
- Napravite boxplot podataka
- Napravite histograme za varijable.
- Postoji li značajna razlika između težina miševa prije i poslije promjene prehrane?

#### Zadatak 3
- Učitajte tablicu "misevi_zadatak3.csv"
- Napravite barplot.
- Promatrani broj miševa s poboljšanjem težine pod tri različite prehrane:
- Postoji li značajna razlika između promatranih i očekivanih rezultata?

#### Zadatak 4
- Učitajte tablicu "misevi_zadatak4.csv"
- Od 15 miševa pod određenom prehranom, njih 10 je pokazalo poboljšanje težine.
- Je li postotak poboljšanja značajno različit od očekivanih 50%?

